---
import Search from '../ui/Search.astro';
import { categories } from '../../data/generated/commands';
---

<header class="bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-40">
  <div class="flex flex-col sm:flex-row justify-between items-center p-4 gap-4 sm:gap-0 max-w-7xl mx-auto w-full">
    <div class="flex items-center gap-3">
      <a href="/" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
        <img src="/MVLOGO.png" alt="Villa Arreola Logo" class="h-8 w-8 sm:h-10 sm:w-10" />
        <span class="text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100">Cheatsheet</span>
      </a>
    </div>
    <div class="flex items-center gap-4 w-full sm:w-auto">
      <div class="flex-1 sm:flex-initial sm:max-w-md">
        <Search />
      </div>
             <nav class="hidden sm:flex items-center gap-6">
         <a href="https://ctf.villaarreola.com" target="_blank" rel="noopener noreferrer" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100 transition-colors">
           CTF Writeups
         </a>
         <span class="text-gray-400 dark:text-gray-500 font-light">|</span>
         <a href="https://kb.villaarreola.com" target="_blank" rel="noopener noreferrer" class="text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100 transition-colors">
           Knowledge Base
         </a>
       </nav>
    </div>
  </div>
  
  <!-- Selector de categorías (solo móvil) -->
  <div class="lg:hidden px-4 pb-4">
         <!-- Enlaces de navegación móvil -->
     <div class="flex items-center justify-center gap-4 mb-4">
       <a href="https://ctf.villaarreola.com" target="_blank" rel="noopener noreferrer" class="text-sm text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100 transition-colors">
         CTF Writeups
       </a>
       <span class="text-gray-400 dark:text-gray-500 font-light">|</span>
       <a href="https://kb.villaarreola.com" target="_blank" rel="noopener noreferrer" class="text-sm text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-gray-100 transition-colors">
         Knowledge Base
       </a>
     </div>
    
    <div class="flex items-start flex-col space-y-3">
      <span class="text-sm font-medium text-gray-600 dark:text-gray-300">Categorías:</span>
      <div class="flex flex-wrap gap-2 w-full">
        {categories.map(category => (
          <button 
            onclick={`selectCategory('${category.id}')`} 
            class={`category-btn px-4 py-2 text-sm rounded-full transition-colors min-h-[44px] touch-manipulation ${category.id === 'all' ? 'active' : ''}`}
          >
            {category.name}
          </button>
        ))}
      </div>
    </div>
  </div>
</header>

<style>
.category-btn {
  background-color: #f3f4f6;
  color: #6b7280;
  border: 1px solid transparent;
}

.category-btn:hover {
  background-color: #e5e7eb;
  color: #374151;
}

.category-btn.active {
  background-color: #3b82f6;
  color: white;
  border-color: #2563eb;
}

.category-btn.active:hover {
  background-color: #2563eb;
}

/* Dark mode styles */
.dark .category-btn {
  background-color: #374151;
  color: #d1d5db;
}

.dark .category-btn:hover {
  background-color: #4b5563;
  color: #f3f4f6;
}

.dark .category-btn.active {
  background-color: #3b82f6;
  color: white;
  border-color: #2563eb;
}

.dark .category-btn.active:hover {
  background-color: #2563eb;
}
</style>

<script>
function selectCategory(category: string) {
  // Actualizar estilos de botones
  document.querySelectorAll('.category-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  (event?.target as HTMLElement)?.classList.add('active');
  
  // Emitir evento para que otros componentes reaccionen
  window.dispatchEvent(new CustomEvent('categoryChanged', { 
    detail: { category } 
  }));
}

// Declarar globalmente
(window as any).selectCategory = selectCategory;

// Mantener una variable CSS con la altura del header para offsets sticky
function setHeaderHeightVar() {
  const headerEl = document.querySelector('header');
  if (!headerEl) return;
  const headerHeightPx = headerEl.getBoundingClientRect().height;
  document.documentElement.style.setProperty('--header-h', `${headerHeightPx}px`);
}

document.addEventListener('DOMContentLoaded', () => {
  setHeaderHeightVar();
  const headerEl = document.querySelector('header');
  if (headerEl && 'ResizeObserver' in window) {
    const ro = new ResizeObserver(() => setHeaderHeightVar());
    ro.observe(headerEl as Element);
  }
});

window.addEventListener('resize', setHeaderHeightVar);
</script>
